{"version":3,"sources":["../src/onlinetextpreview.js"],"names":["define","$","ModalFactory","str","ajax","log","notification","instance","Onlinetextpreview","cmid","initializer","config","info","modal","modalpromise","create","type","types","DEFAULT","large","get_strings","key","component","done","s","click","e","stopPropagation","preventDefault","element","target","dataelement","parent","itemid","data","ex","exception","call","methodname","args","itemname","length","toLowerCase","setTitle","setBody","show","fail","error"],"mappings":"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","sourcesContent":["// This file is part of mod_publication for Moodle - http://moodle.org/\n//\n// It is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// It is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JS showing detailed infos about user's approval status for group approvals in a modal window\n *\n * @module        mod_publication/onlinetextpreview\n * @package\n * @author        Philipp Hager\n * @copyright     2020 Academic Moodle Cooperation {@link http://www.academic-moodle-cooperation.org}\n * @license       http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_publication/onlinetextpreview\n */\ndefine(['jquery', 'core/modal_factory', 'core/str', 'core/ajax', 'core/log', 'core/notification'], function($,\n        ModalFactory, str, ajax, log, notification) {\n\n    /**\n     * @constructor\n     * @alias module:mod_publication/Onlinetextpreview\n     */\n    var Onlinetextpreview = function() {\n        this.cmid = '';\n    };\n\n    var instance = new Onlinetextpreview();\n\n    /**\n     * Initialises the JavaScript for publication's group approval status tooltips\n     *\n     *\n     * @param {Object} config The configuration\n     */\n    instance.initializer = function(config) {\n        instance.cmid = config.cmid;\n\n        log.info('Initialize onlinetextpreview JS!', 'mod_publication');\n\n        // Prepare modal object!\n        if (!instance.modal) {\n            instance.modalpromise = ModalFactory.create({\n                type: ModalFactory.types.DEFAULT,\n                large: true\n            });\n        }\n\n        str.get_strings([\n            {key: 'preview', component: 'core'},\n            {key: 'onlinetextfilename', component: 'assignsubmission_onlinetext'},\n            {key: 'from', component: 'core'}\n        ]).done(function(s) {\n            log.info('Done loading strings...', 'mod_publication');\n            instance.modalpromise.done(function(modal) {\n                log.info('Done preparing modal', 'mod_publication');\n                instance.modal = modal;\n                $('.path-mod-publication table.publications .onlinetextpreview *').click(function(e) {\n                    e.stopPropagation();\n                    e.preventDefault();\n                    var element = $(e.target);\n\n                    var dataelement = element.parent();\n\n                    var itemid;\n                    try {\n                        itemid = dataelement.data('itemid');\n                    } catch (ex) {\n                        notification.exception(ex);\n                    }\n\n                    ajax.call([\n                        {\n                            methodname: 'mod_publication_get_onlinetextpreview',\n                            args: {itemid: itemid, cmid: instance.cmid},\n                            done: function(data) {\n                                var itemname = '';\n                                if (dataelement.data('itemname').length) {\n                                    itemname = ' ' + s[2].toLowerCase() + ' ' + dataelement.data('itemname');\n                                }\n                                instance.modal.setTitle(s[0] + ' ' + s[1] + itemname);\n                                instance.modal.setBody(data);\n                                instance.modal.show();\n                            },\n                            fail: function(ex) {\n                                notification.exception(ex);\n                            }\n                        }\n                    ]);\n                });\n            });\n        }).fail(function(ex) {\n            log.error('Error getting strings: ' + ex, 'mod_publication');\n        });\n    };\n\n    return instance;\n});\n"],"file":"onlinetextpreview.min.js"}
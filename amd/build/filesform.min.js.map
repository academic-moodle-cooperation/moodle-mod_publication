{"version":3,"file":"filesform.min.js","sources":["../src/filesform.js"],"sourcesContent":["// This file is part of mod_publication for Moodle - http://moodle.org/\n//\n// It is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// It is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Resets checked checkboxes after ZIP file was loaded!\n *\n * @module        mod_publication/filesform\n * @package\n * @author        Philipp Hager\n * @author        Hannes Laimer\n * @author        Andreas Windbichler\n * @copyright     2020 Academic Moodle Cooperation {@link http://www.academic-moodle-cooperation.org}\n * @license       http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_publication/filesform\n */\ndefine(['jquery', 'core/log'], function($, log) {\n\n    /**\n     * @constructor\n     * @alias module:mod_publication/modform\n     */\n    var Filesform = function() {\n        this.form = $('#fastg');\n        this.menuaction = $('#menuaction');\n        this.usersel = $('.userselection');\n        this.attemptstable = $('table#attempts');\n    };\n\n    var instance = new Filesform();\n\n    instance.initializer = function() {\n        log.info('Initialize filesform JS!', 'mod_publication');\n        instance.form.on('submit', function() {\n            if (instance.menuaction.val() === 'zipusers') {\n                setTimeout(function() {\n                    instance.usersel.prop('checked', false);\n                }, 100);\n            }\n        });\n        if (this.attemptstable.length > 0) {\n            var $rows = this.attemptstable.children('tbody').children('tr');\n            var needsapprovalcount = 0;\n            $rows.each(function() {\n                var $this = $(this);\n                var $checkbox = $this.find('.permissionstable select.custom-select');\n                if ($checkbox.length > 0) {\n                    $checkbox.each(function() {\n                         var $c = $(this);\n                         if ($c.val() === '') {\n                             if (!$c.hasClass('needs-approval')) {\n                                 $c.addClass('needs-approval');\n                                 needsapprovalcount++;\n                                 $c.after('<span class=\"needs-approval-asterisk\">*</span>');\n                             }\n                         }\n                    });\n                }\n            });\n            if (needsapprovalcount > 0) {\n                $('.needsapproval-legend').removeClass('d-none');\n            }\n        }\n\n    };\n\n    return instance;\n});\n"],"names":["define","$","log","instance","form","menuaction","usersel","attemptstable","initializer","info","on","val","setTimeout","prop","this","length","$rows","children","needsapprovalcount","each","$checkbox","find","$c","hasClass","addClass","after","removeClass"],"mappings":";;;;;;;;;;;AA8BAA,mCAAO,CAAC,SAAU,aAAa,SAASC,EAAGC,SAanCC,SAAW,IAPC,gBACPC,KAAOH,EAAE,eACTI,WAAaJ,EAAE,oBACfK,QAAUL,EAAE,uBACZM,cAAgBN,EAAE,0BAK3BE,SAASK,YAAc,cACnBN,IAAIO,KAAK,2BAA4B,mBACrCN,SAASC,KAAKM,GAAG,UAAU,WACW,aAA9BP,SAASE,WAAWM,OACpBC,YAAW,WACPT,SAASG,QAAQO,KAAK,WAAW,KAClC,QAGPC,KAAKP,cAAcQ,OAAS,EAAG,KAC3BC,MAAQF,KAAKP,cAAcU,SAAS,SAASA,SAAS,MACtDC,mBAAqB,EACzBF,MAAMG,MAAK,eAEHC,UADQnB,EAAEa,MACQO,KAAK,0CACvBD,UAAUL,OAAS,GACnBK,UAAUD,MAAK,eACNG,GAAKrB,EAAEa,MACM,KAAbQ,GAAGX,QACEW,GAAGC,SAAS,oBACbD,GAAGE,SAAS,kBACZN,qBACAI,GAAGG,MAAM,0DAM1BP,mBAAqB,GACrBjB,EAAE,yBAAyByB,YAAY,YAM5CvB"}
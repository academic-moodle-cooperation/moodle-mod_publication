{"version":3,"sources":["../src/filesform.js"],"names":["define","$","log","instance","Filesform","form","menuaction","usersel","attemptstable","initializer","info","on","val","setTimeout","prop","length","$rows","children","needsapprovalcount","each","$this","$checkbox","find","$c","hasClass","addClass","after","removeClass"],"mappings":"AA6BAA,OAAM,6BAAC,CAAC,QAAD,CAAW,UAAX,CAAD,CAAyB,SAASC,CAAT,CAAYC,CAAZ,CAAiB,IAaxCC,CAAAA,CAAQ,CAAG,GAPC,SAAZC,CAAAA,SAAY,EAAW,CACvB,KAAKC,IAAL,CAAYJ,CAAC,CAAC,QAAD,CAAb,CACA,KAAKK,UAAL,CAAkBL,CAAC,CAAC,aAAD,CAAnB,CACA,KAAKM,OAAL,CAAeN,CAAC,CAAC,gBAAD,CAAhB,CACA,KAAKO,aAAL,CAAqBP,CAAC,CAAC,gBAAD,CACzB,CAX2C,CAe5CE,CAAQ,CAACM,WAAT,CAAuB,UAAW,CAC9BP,CAAG,CAACQ,IAAJ,CAAS,0BAAT,CAAqC,iBAArC,EACAP,CAAQ,CAACE,IAAT,CAAcM,EAAd,CAAiB,QAAjB,CAA2B,UAAW,CAClC,GAAkC,UAA9B,GAAAR,CAAQ,CAACG,UAAT,CAAoBM,GAApB,EAAJ,CAA8C,CAC1CC,UAAU,CAAC,UAAW,CAClBV,CAAQ,CAACI,OAAT,CAAiBO,IAAjB,CAAsB,SAAtB,IACH,CAFS,CAEP,GAFO,CAGb,CACJ,CAND,EAOA,GAAgC,CAA5B,MAAKN,aAAL,CAAmBO,MAAvB,CAAmC,IAC3BC,CAAAA,CAAK,CAAG,KAAKR,aAAL,CAAmBS,QAAnB,CAA4B,OAA5B,EAAqCA,QAArC,CAA8C,IAA9C,CADmB,CAE3BC,CAAkB,CAAG,CAFM,CAG/BF,CAAK,CAACG,IAAN,CAAW,UAAW,IACdC,CAAAA,CAAK,CAAGnB,CAAC,CAAC,IAAD,CADK,CAEdoB,CAAS,CAAGD,CAAK,CAACE,IAAN,CAAW,wCAAX,CAFE,CAGlB,GAAuB,CAAnB,CAAAD,CAAS,CAACN,MAAd,CAA0B,CACtBM,CAAS,CAACF,IAAV,CAAe,UAAW,CACrB,GAAII,CAAAA,CAAE,CAAGtB,CAAC,CAAC,IAAD,CAAV,CACA,GAAiB,EAAb,GAAAsB,CAAE,CAACX,GAAH,EAAJ,CAAqB,CACjB,GAAI,CAACW,CAAE,CAACC,QAAH,CAAY,gBAAZ,CAAL,CAAoC,CAChCD,CAAE,CAACE,QAAH,CAAY,gBAAZ,EACAP,CAAkB,GAClBK,CAAE,CAACG,KAAH,CAAS,kDAAT,CACH,CACJ,CACL,CATD,CAUH,CACJ,CAfD,EAgBA,GAAyB,CAArB,CAAAR,CAAJ,CAA4B,CACxBjB,CAAC,CAAC,uBAAD,CAAD,CAA2B0B,WAA3B,CAAuC,QAAvC,CACH,CACJ,CAEJ,CAjCD,CAmCA,MAAOxB,CAAAA,CACV,CAnDK,CAAN","sourcesContent":["// This file is part of mod_publication for Moodle - http://moodle.org/\n//\n// It is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// It is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Resets checked checkboxes after ZIP file was loaded!\n *\n * @package       mod_publication\n * @author        Philipp Hager\n * @author        Hannes Laimer\n * @author        Andreas Windbichler\n * @copyright     2020 Academic Moodle Cooperation {@link http://www.academic-moodle-cooperation.org}\n * @license       http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_publication/filesform\n */\ndefine(['jquery', 'core/log'], function($, log) {\n\n    /**\n     * @constructor\n     * @alias module:mod_publication/modform\n     */\n    var Filesform = function() {\n        this.form = $('#fastg');\n        this.menuaction = $('#menuaction');\n        this.usersel = $('.userselection');\n        this.attemptstable = $('table#attempts');\n    };\n\n    var instance = new Filesform();\n\n    instance.initializer = function() {\n        log.info('Initialize filesform JS!', 'mod_publication');\n        instance.form.on('submit', function() {\n            if (instance.menuaction.val() === 'zipusers') {\n                setTimeout(function() {\n                    instance.usersel.prop('checked', false);\n                }, 100);\n            }\n        });\n        if (this.attemptstable.length > 0) {\n            var $rows = this.attemptstable.children('tbody').children('tr');\n            var needsapprovalcount = 0;\n            $rows.each(function() {\n                var $this = $(this);\n                var $checkbox = $this.find('.permissionstable select.custom-select');\n                if ($checkbox.length > 0) {\n                    $checkbox.each(function() {\n                         var $c = $(this);\n                         if ($c.val() === '') {\n                             if (!$c.hasClass('needs-approval')) {\n                                 $c.addClass('needs-approval');\n                                 needsapprovalcount++;\n                                 $c.after('<span class=\"needs-approval-asterisk\">*</span>');\n                             }\n                         }\n                    });\n                }\n            });\n            if (needsapprovalcount > 0) {\n                $('.needsapproval-legend').removeClass('d-none');\n            }\n        }\n\n    };\n\n    return instance;\n});\n"],"file":"filesform.min.js"}
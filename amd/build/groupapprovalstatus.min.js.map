{"version":3,"sources":["../src/groupapprovalstatus.js"],"names":["define","$","ModalFactory","str","templates","log","instance","Groupapprovalstatus","id","initializer","config","mode","info","modal","modalpromise","create","type","types","DEFAULT","body","get_string","done","s","click","e","stopPropagation","element","target","dataelement","parent","approved","data","ex","rejected","pending","filename","stat","context","status","promise","render","source","setTitle","setBody","show","fail","message","fadeIn","error"],"mappings":"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","sourcesContent":["// This file is part of mod_publication for Moodle - http://moodle.org/\n//\n// It is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// It is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JS showing detailed infos about user's approval status for group approvals in a modal window\n *\n * @module        mod_publication/groupapprovalstatus\n * @package\n * @author        Philipp Hager\n * @copyright     2020 Academic Moodle Cooperation {@link http://www.academic-moodle-cooperation.org}\n * @license       http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_publication/groupapprovalstatus\n */\ndefine(['jquery', 'core/modal_factory', 'core/str', 'core/templates', 'core/log'], function($, ModalFactory, str, templates, log) {\n\n    /**\n     * @constructor\n     * @alias module:mod_publication/groupapprovalstatus\n     */\n    var Groupapprovalstatus = function() {\n        this.id = '';\n    };\n\n    var instance = new Groupapprovalstatus();\n\n    /**\n     * Initialises the JavaScript for publication's group approval status tooltips\n     *\n     *\n     * @param {Object} config The configuration\n     */\n    instance.initializer = function(config) {\n        instance.id = config.id;\n        instance.mode = config.mode;\n\n        log.info('Initialize groupapprovalstatus JS!', 'mod_publication');\n\n        // Prepare modal object!\n        if (!instance.modal) {\n            instance.modalpromise = ModalFactory.create({\n                type: ModalFactory.types.DEFAULT,\n                body: '...'\n            });\n        }\n\n        str.get_string('filedetails', 'mod_publication').done(function(s) {\n            log.info('Done loading strings...', 'mod_publication');\n            instance.modalpromise.done(function(modal) {\n                log.info('Done preparing modal', 'mod_publication');\n                instance.modal = modal;\n                $('.path-mod-publication .statustable .approvaldetails *').click(function(e) {\n                    e.stopPropagation();\n                    var element = $(e.target);\n\n                    var dataelement = element.parent();\n\n                    var approved;\n                    try {\n                        approved = dataelement.data('approved');\n                    } catch (ex) {\n                        approved = [];\n                    }\n\n                    var rejected;\n                    try {\n                        rejected = dataelement.data('rejected');\n                    } catch (ex) {\n                        rejected = [];\n                    }\n\n                    var pending;\n                    try {\n                        pending = dataelement.data('pending');\n                    } catch (ex) {\n                        pending = [];\n                    }\n\n                    var filename;\n                    try {\n                        filename = s + ' ' + dataelement.data('filename');\n                    } catch (ex) {\n                        filename = s;\n                    }\n\n                    var stat;\n                    try {\n                        stat = dataelement.data('status');\n                    } catch (ex) {\n                        stat = {\n                            approved: false,\n                            rejected: false,\n                            pending: false\n                        };\n                    }\n\n                    var context = {\n                        id: instance.id,\n                        mode: instance.mode,\n                        status: stat,\n                        approved: approved,\n                        rejected: rejected,\n                        pending: pending\n                    };\n\n                    // This will call the function to load and render our template.\n                    var promise = templates.render('mod_publication/approvaltooltip', context);\n\n                    // How we deal with promise objects is by adding callbacks.\n                    promise.done(function(source) {\n                        // Here eventually I have my compiled template, and any javascript that it generated.\n                        instance.modal.setTitle(filename);\n                        instance.modal.setBody(source);\n                        instance.modal.show();\n                    }).fail(function(ex) {\n                        // Deal with this exception (I recommend core/notify exception function for this).\n                        instance.modal.setBody(ex.message);\n                        instance.modal.show();\n                    });\n                });\n                // Everything is prepared, fade the symbols in!\n                $('.path-mod-publication .statustable .approvaldetails').fadeIn('slow');\n            });\n        }).fail(function(ex) {\n            log.error('Error getting strings: ' + ex, 'mod_publication');\n        });\n    };\n\n    return instance;\n});\n"],"file":"groupapprovalstatus.min.js"}
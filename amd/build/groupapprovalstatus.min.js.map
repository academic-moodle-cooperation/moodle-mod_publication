{"version":3,"file":"groupapprovalstatus.min.js","sources":["../src/groupapprovalstatus.js"],"sourcesContent":["// This file is part of mod_publication for Moodle - http://moodle.org/\n//\n// It is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// It is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JS showing detailed infos about user's approval status for group approvals in a modal window\n *\n * @module        mod_publication/groupapprovalstatus\n * @package\n * @author        Philipp Hager\n * @copyright     2020 Academic Moodle Cooperation {@link http://www.academic-moodle-cooperation.org}\n * @license       http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_publication/groupapprovalstatus\n */\ndefine(['jquery', 'core/modal_factory', 'core/str', 'core/templates', 'core/log'], function($, ModalFactory, str, templates, log) {\n\n    /**\n     * @constructor\n     * @alias module:mod_publication/groupapprovalstatus\n     */\n    var Groupapprovalstatus = function() {\n        this.id = '';\n    };\n\n    var instance = new Groupapprovalstatus();\n\n    /**\n     * Initialises the JavaScript for publication's group approval status tooltips\n     *\n     *\n     * @param {Object} config The configuration\n     */\n    instance.initializer = function(config) {\n        instance.id = config.id;\n        instance.mode = config.mode;\n\n        log.info('Initialize groupapprovalstatus JS!', 'mod_publication');\n\n        // Prepare modal object!\n        if (!instance.modal) {\n            instance.modalpromise = ModalFactory.create({\n                type: ModalFactory.types.DEFAULT,\n                body: '...'\n            });\n        }\n\n        str.get_string('filedetails', 'mod_publication').done(function(s) {\n            log.info('Done loading strings...', 'mod_publication');\n            instance.modalpromise.done(function(modal) {\n                log.info('Done preparing modal', 'mod_publication');\n                instance.modal = modal;\n                $('.path-mod-publication .statustable .approvaldetails *').click(function(e) {\n                    e.stopPropagation();\n                    var element = $(e.target);\n\n                    var dataelement = element.parent();\n\n                    var approved;\n                    try {\n                        approved = dataelement.data('approved');\n                    } catch (ex) {\n                        approved = [];\n                    }\n\n                    var rejected;\n                    try {\n                        rejected = dataelement.data('rejected');\n                    } catch (ex) {\n                        rejected = [];\n                    }\n\n                    var pending;\n                    try {\n                        pending = dataelement.data('pending');\n                    } catch (ex) {\n                        pending = [];\n                    }\n\n                    var filename;\n                    try {\n                        filename = s + ' ' + dataelement.data('filename');\n                    } catch (ex) {\n                        filename = s;\n                    }\n\n                    var stat;\n                    try {\n                        stat = dataelement.data('status');\n                    } catch (ex) {\n                        stat = {\n                            approved: false,\n                            rejected: false,\n                            pending: false\n                        };\n                    }\n\n                    var context = {\n                        id: instance.id,\n                        mode: instance.mode,\n                        status: stat,\n                        approved: approved,\n                        rejected: rejected,\n                        pending: pending\n                    };\n\n                    // This will call the function to load and render our template.\n                    var promise = templates.render('mod_publication/approvaltooltip', context);\n\n                    // How we deal with promise objects is by adding callbacks.\n                    promise.done(function(source) {\n                        // Here eventually I have my compiled template, and any javascript that it generated.\n                        instance.modal.setTitle(filename);\n                        instance.modal.setBody(source);\n                        instance.modal.show();\n                    }).fail(function(ex) {\n                        // Deal with this exception (I recommend core/notify exception function for this).\n                        instance.modal.setBody(ex.message);\n                        instance.modal.show();\n                    });\n                });\n                // Everything is prepared, fade the symbols in!\n                $('.path-mod-publication .statustable .approvaldetails').fadeIn('slow');\n            });\n        }).fail(function(ex) {\n            log.error('Error getting strings: ' + ex, 'mod_publication');\n        });\n    };\n\n    return instance;\n});\n"],"names":["define","$","ModalFactory","str","templates","log","instance","id","initializer","config","mode","info","modal","modalpromise","create","type","types","DEFAULT","body","get_string","done","s","click","e","stopPropagation","approved","rejected","pending","filename","stat","dataelement","target","parent","data","ex","context","status","render","source","setTitle","setBody","show","fail","message","fadeIn","error"],"mappings":";;;;;;;;;AA4BAA,6CAAO,CAAC,SAAU,qBAAsB,WAAY,iBAAkB,aAAa,SAASC,EAAGC,aAAcC,IAAKC,UAAWC,SAUrHC,SAAW,IAJW,gBACjBC,GAAK,WAWdD,SAASE,YAAc,SAASC,QAC5BH,SAASC,GAAKE,OAAOF,GACrBD,SAASI,KAAOD,OAAOC,KAEvBL,IAAIM,KAAK,qCAAsC,mBAG1CL,SAASM,QACVN,SAASO,aAAeX,aAAaY,OAAO,CACxCC,KAAMb,aAAac,MAAMC,QACzBC,KAAM,SAIdf,IAAIgB,WAAW,cAAe,mBAAmBC,MAAK,SAASC,GAC3DhB,IAAIM,KAAK,0BAA2B,mBACpCL,SAASO,aAAaO,MAAK,SAASR,OAChCP,IAAIM,KAAK,uBAAwB,mBACjCL,SAASM,MAAQA,MACjBX,EAAE,yDAAyDqB,OAAM,SAASC,GACtEA,EAAEC,sBAKEC,SAOAC,SAOAC,QAOAC,SAOAC,KA9BAC,YAFU7B,EAAEsB,EAAEQ,QAEQC,aAItBP,SAAWK,YAAYG,KAAK,YAC9B,MAAOC,IACLT,SAAW,OAKXC,SAAWI,YAAYG,KAAK,YAC9B,MAAOC,IACLR,SAAW,OAKXC,QAAUG,YAAYG,KAAK,WAC7B,MAAOC,IACLP,QAAU,OAKVC,SAAWP,EAAI,IAAMS,YAAYG,KAAK,YACxC,MAAOC,IACLN,SAAWP,MAKXQ,KAAOC,YAAYG,KAAK,UAC1B,MAAOC,IACLL,KAAO,CACHJ,UAAU,EACVC,UAAU,EACVC,SAAS,OAIbQ,QAAU,CACV5B,GAAID,SAASC,GACbG,KAAMJ,SAASI,KACf0B,OAAQP,KACRJ,SAAUA,SACVC,SAAUA,SACVC,QAASA,SAICvB,UAAUiC,OAAO,kCAAmCF,SAG1Df,MAAK,SAASkB,QAElBhC,SAASM,MAAM2B,SAASX,UACxBtB,SAASM,MAAM4B,QAAQF,QACvBhC,SAASM,MAAM6B,UAChBC,MAAK,SAASR,IAEb5B,SAASM,MAAM4B,QAAQN,GAAGS,SAC1BrC,SAASM,MAAM6B,aAIvBxC,EAAE,uDAAuD2C,OAAO,cAErEF,MAAK,SAASR,IACb7B,IAAIwC,MAAM,0BAA4BX,GAAI,uBAI3C5B"}